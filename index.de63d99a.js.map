{"mappings":"AAAA,MAAMA,EAAU,CACd,MACA,KACA,MACA,SACA,SACA,UAGIC,EAAW,CACf,SAKIC,EAAS,GAEf,IAAK,MAAMC,KAAUH,EAAS,CAC5B,MAAMI,EAAQC,SAASC,cAAc,SACrCF,EAAMG,UAAUC,IAAI,UACpBJ,EAAMK,aAAa,UAAW,QAE9B,MAAMC,EAASL,SAASC,cAAc,UACtCI,EAAOC,IAAG,GAAMR,QAEhBC,EAAMQ,YAAYF,GAClBL,SAASQ,KAAKD,YAAYR,GAE1BF,EAAOC,GAAUC,EAGnB,IAAIU,GAAU,EACVC,GAAY,EAChB,MAAMC,EAAiBX,SAASC,cAAc,OAC9CU,EAAeT,UAAUC,IAAI,mBAE7B,MAAMS,EAAYZ,SAASC,cAAc,OACzCW,EAAUN,IAAM,aAChBM,EAAUC,QAAO,KACfC,EAAW,UACXC,EAAYC,QACZJ,EAAUV,UAAUC,IAAI,UACxBc,EAAQf,UAAUgB,OAAO,UACzBR,GAAY,EACZD,GAAU,GAGZ,MAAMQ,EAAUjB,SAASC,cAAc,gBAiB9Ba,EAAWhB,GAClBqB,OAAOC,OAAOvB,GAAQwB,SAAStB,IAC7BA,EAAMG,UAAUC,IAAI,UACpBJ,EAAMuB,QACNvB,EAAMwB,YAAc,KAEtB1B,EAAOC,GAAQI,UAAUgB,OAAO,UAChCrB,EAAOC,GAAQ0B,OAvBjBP,EAAQX,IAAM,aACdW,EAAQf,UAAUC,IAAI,UACtBc,EAAQJ,QAAO,KACbC,EAAW,UACXC,EAAYU,OACZR,EAAQf,UAAUC,IAAI,UACtBS,EAAUV,UAAUgB,OAAO,UAC3BR,GAAY,GAGdC,EAAeJ,YAAYK,GAC3BD,EAAeJ,YAAYU,GAC3BjB,SAASQ,KAAKkB,OAAOf,GAErBd,EAAO8B,OAAOzB,UAAUgB,OAAO,UA6B/B,MACMH,EAAc,IADMa,OAAOC,mBAAqBD,OAAOE,yBAE7DC,QAAQC,IAAIjB,GAEZA,EAAYkB,gBAAiB,EAE7BlB,EAAYmB,iBAAiB,UAAWC,IACtC,MAAMC,EAAUD,EAAME,QAAQ,GAAGD,QAC3BE,EAAUC,MAAMC,KAAKL,EAAME,SAC9BI,KAAIC,GAAUA,EAAO,KACrBD,KAAIC,GAAUA,EAAOC,aACrBC,KAAK,IACLC,cAIH,GAFAd,QAAQC,IAAIM,GAERF,EAAS,CAGX,GAFA3B,GAAU,EAENb,EAASkD,MAAKC,IAAkC,IAA1BT,EAAQU,QAAQD,KAKxC,qBArCgBT,EAAiBW,GACrC,MAAMC,EAAS,IAAIC,yBAEnBD,EAAOE,KAAOd,EACdY,EAAOG,OAAS,EAChBH,EAAOI,KAAO,EACdJ,EAAOK,MAAQ,EAEf3B,OAAO4B,gBAAgBC,MAAMP,GAC7BA,EAAOhB,iBAAiB,OAAK,IAAQe,MAwBjCS,CAAa,wBAAsB,KACjCzC,EAAQ0C,WAMZ,MAAMC,GA5CSC,EA4Ce,EA5CFC,EA4CKnE,EAAQoE,OAAS,EA3C7CC,KAAKC,MAAMD,KAAKE,UAAYJ,EAAMD,EAAM,GAAKA,IA4ClD/C,EAAWnB,EAAQiE,QA7CJC,EAAaC,KAiDhC/C,EAAYmB,iBAAiB,OAAK,KAC3BxB,IAIDD,EACFQ,EAAQ0C,SAIV5C,EAAYC,QACZP,GAAU","sources":["src/index.ts"],"sourcesContent":["const answers = [\n  'agh',\n  'no',\n  'yes',\n  'hohoho',\n  'hangup',\n  'pickup'\n] as const\n\nconst banWords = [\n  'путин'\n]\n\ntype Answers = typeof answers[number]\n\nconst videos = {} as Record<Answers, HTMLVideoElement>\n\nfor (const answer of answers) {\n  const video = document.createElement('video')\n  video.classList.add('hidden')\n  video.setAttribute('preload', 'auto')\n\n  const source = document.createElement('source')\n  source.src = `${answer}.mp4`\n\n  video.appendChild(source)\n  document.body.appendChild(video)\n\n  videos[answer] = video\n}\n\nlet hasIdle = false\nlet hasEnable = false\nconst phoneContainer = document.createElement('div')\nphoneContainer.classList.add('phone-container')\n\nconst callStart = document.createElement('img')\ncallStart.src = 'pickup.png'\ncallStart.onclick = () => {\n  playAnswer('pickup')\n  recognition.start()\n  callStart.classList.add('hidden')\n  callEnd.classList.remove('hidden')\n  hasEnable = true\n  hasIdle = false\n}\n\nconst callEnd = document.createElement('img')\ncallEnd.src = 'hangup.png'\ncallEnd.classList.add('hidden')\ncallEnd.onclick = () => {\n  playAnswer('hangup')\n  recognition.stop()\n  callEnd.classList.add('hidden')\n  callStart.classList.remove('hidden')\n  hasEnable = false\n}\n\nphoneContainer.appendChild(callStart)\nphoneContainer.appendChild(callEnd)\ndocument.body.append(phoneContainer)\n\nvideos.pickup.classList.remove('hidden')\n\nfunction playAnswer(answer: Answers): void {\n  Object.values(videos).forEach((video) => {\n    video.classList.add('hidden')\n    video.pause()\n    video.currentTime = 0\n  })\n  videos[answer].classList.remove('hidden')\n  videos[answer].play()\n}\n\nfunction randomInt(min: number, max: number): number {\n  return Math.floor(Math.random() * (max - min + 1) + min)\n}\n\nfunction textToSpeech(message: string, end: () => void): void {\n  const speech = new SpeechSynthesisUtterance()\n\n  speech.text = message\n  speech.volume = 1\n  speech.rate = 5\n  speech.pitch = 5\n\n  window.speechSynthesis.speak(speech)\n  speech.addEventListener('end', () => end())\n}\n\n// TODO: fix types\nconst SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\nconst recognition = new SpeechRecognition()\nconsole.log(recognition)\n\nrecognition.interimResults = true\n\nrecognition.addEventListener('result', (event) => {\n  const isFinal = event.results[0].isFinal\n  const message = Array.from(event.results)\n    .map(result => result[0])\n    .map(result => result.transcript)\n    .join('')\n    .toLowerCase()\n\n  console.log(message)\n\n  if (isFinal) {\n    hasIdle = false\n\n    if (banWords.some(word => message.indexOf(word) !== -1)) {\n      textToSpeech('Пошел нахуй, долбаёб', () => {\n        callEnd.click()\n      })\n\n      return\n    }\n\n    const answerIndex = randomInt(0, answers.length - 3)\n    playAnswer(answers[answerIndex])\n  }\n})\n\nrecognition.addEventListener('end', () => {\n  if (!hasEnable) {\n    return\n  }\n\n  if (hasIdle) {\n    callEnd.click()\n    return\n  }\n\n  recognition.start()\n  hasIdle = true\n})\n"],"names":["$b4e14b6b8da86996$var$answers","$b4e14b6b8da86996$var$banWords","$b4e14b6b8da86996$var$videos","answer","video","document","createElement","classList","add","setAttribute","source","src","appendChild","body","$b4e14b6b8da86996$var$hasIdle","$b4e14b6b8da86996$var$hasEnable","$b4e14b6b8da86996$var$phoneContainer","$b4e14b6b8da86996$var$callStart","onclick","$b4e14b6b8da86996$var$playAnswer","$b4e14b6b8da86996$var$recognition","start","$b4e14b6b8da86996$var$callEnd","remove","Object","values","forEach","pause","currentTime","play","stop","append","pickup","window","SpeechRecognition","webkitSpeechRecognition","console","log","interimResults","addEventListener","event","isFinal","results","message","Array","from","map","result","transcript","join","toLowerCase","some","word","indexOf","end","speech","SpeechSynthesisUtterance","text","volume","rate","pitch","speechSynthesis","speak","$b4e14b6b8da86996$var$textToSpeech","click","answerIndex","min","max","length","Math","floor","random"],"version":3,"file":"index.de63d99a.js.map"}